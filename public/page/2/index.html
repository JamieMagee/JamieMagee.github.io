<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
	<meta name="generator" content="Hugo 0.54.0" />
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">


  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Jamie Magee &middot; Jamie Magee</title>


  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/hyde.css">
  <link rel="stylesheet" href="/css/poole-overrides.css">
  <link rel="stylesheet" href="/css/hyde-overrides.css">
  <link rel="stylesheet" href="/css/hyde-x.css">
  <link rel="stylesheet" href="/css/highlight/github.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/jamie.css">


  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
  <link href="/favicon.ico" rel="icon">




  <link href="/index.xml" rel="alternate" type="application/rss+xml" title="Jamie Magee &middot; Jamie Magee" />

  <meta name="description" content="">
  <meta name="keywords" content="">


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-701081-9', 'auto');

	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body class="theme-base-0c">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <div class="sidebar-head">

        <img src="https://www.gravatar.com/avatar/5a37e2531db08529192d7d323e8cecd8?s=200"
             alt="gravatar" title="Jamie Magee">

      <h1><a href="/">Jamie Magee</a></h1>
      </div>
      <p class="lead">Programmer, Engineer, Problem Solver</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="/">Home</a></li>

      <li class="sidebar-nav-item "><a href="/about">About</a></li>

      <li class="sidebar-nav-item "><a href="/blog">Archive</a></li>

    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/JamieMagee"><i class="fa fa-github-square fa-3x"></i></a>


      <a href="https://www.linkedin.com/in/jamiemagee1/"><i class="fa fa-linkedin-square fa-3x"></i></a>


      <a href="http://twitter.com/Jamie_Magee"><i class="fa fa-twitter-square fa-3x"></i></a>


      </li>
    </ul>



    <p>
  &copy; 2019. <a href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a>
</p>

  </div>
</div>


<div class="content container">
  <div class="posts">


    <div class="post">
      <h1 class="post-title">
        <a href="/blog/continuous-deployment-jekyll-to-azure/">Continuously deploy Jekyll to Azure Web Apps</a>
      </h1>
      <span class="post-date">Mar 31, 2015 &middot; 4 minute read &middot; <a href="/blog/continuous-deployment-jekyll-to-azure/#disqus_thread">Comments</a>
      </span>



<p>I&rsquo;ve been thinking about writing a blog for a while now, but there are just so many blogging platforms out there to choose from. I finally settled on Jekyll as it&rsquo;s really lightweight (compared to platforms like Wordpress), it has an active development community, and you can write all your articles in Markdown.</p>

<p>Many Jekyll users host their Jekyll sites through GitHub Pages, and there are a lot of advantages to this:</p>

<ul>
<li>Free web hosting</li>
<li>Built in version control</li>
<li>Continuous deployment</li>
</ul>

<p>However, the main disadvantage is that GitHub Pages runs Jekyll in safe mode. This means that it&rsquo;s not possible to extend Jekyll with plugins. There are some ways to avoid this restriction, but they&rsquo;re all awkward workarounds.</p>

<h2 id="a-solution">A solution</h2>

<p>I still wanted all the advantages GitHub Pages has, but with Jekyll plugins too. The solution was to use <a href="https://travis-ci.org">Travis</a> to build the Jekyll site and host it on <a href="https://azure.microsoft.com/en-us/services/app-service/web/">Azure Web Apps</a>. Travis is a continuous integration service that&rsquo;s free for open source projects to use, and I&rsquo;m going to use it to build my Jekyll site. Azure provides cheap, or even free, web hosting for websites and it&rsquo;s what I&rsquo;m familiar with.</p>

<h2 id="azure">Azure</h2>

<p>First of all you need to create an Azure Web App.</p>

<ul>
<li>Go to the <a href="https://portal.azure.com">Azure Portal</a></li>
<li>Click New &gt; Compute &gt; Web App &gt; Quick Create</li>
<li>Enter the URL you want and select an app service plan</li>
</ul>

<p><img src="/img/azure-new-web-app.png" alt="Azure new web app" /></p>

<p>On the dashboard for your new web app, make a note of the FTP host name and your deployment credentials. If you&rsquo;ve forgotten your deployment credentials you can reset them from here as well.</p>

<h2 id="github">GitHub</h2>

<p>I know I said earlier that I didn&rsquo;t want to use GitHub, but I&rsquo;m not actually using GitHub Pages. Travis depends on <a href="https://developer.github.com/v3/repos/hooks/">GitHub Webhooks</a> in order to figure out when you push an update to your site and kick off a build. In addition to the standard Jekyll files you&rsquo;ll need to add a <code>.travis.yml</code> configuration file as well as a build and deploy script. My Travis configuration looks like this:</p>

<pre><code class="language-yaml">language: ruby
rvm:
  - 2.2
script:
  - chmod +x script/build
  - ./script/build
after_success:
  - chmod +x script/deploy
  - ./script/deploy
env:
  global:
    - NOKOGIRI_USE_SYSTEM_LIBRARIES=true
</code></pre>

<p>Taking it section by section</p>

<pre><code class="language-yaml">language: ruby
rvm:
  - 2.2
</code></pre>

<p>This tells Travis that the project is Ruby based, and what version of Ruby to use - in this case Ruby 2.2.</p>

<pre><code class="language-yaml">script:
  - chmod +x script/build
  - ./script/build
</code></pre>

<p>My build script in the <code>scripts</code> directory. This sets the execute flag, then executes it.</p>

<pre><code class="language-yaml">after_success:
  - chmod +x script/deploy
  - ./script/deploy
</code></pre>

<p>If the build is successful, Travis will set the execute flag on the <code>deploy</code> script, then execute it.</p>

<pre><code class="language-yaml">env:
  global:
    - NOKOGIRI_USE_SYSTEM_LIBRARIES=true
</code></pre>

<p>I&rsquo;m using <code>html-proofer</code> to check all the links and images on my site, and this allows me to speed up the build time by using pre-installed libraries.</p>

<p>Now onto the <code>build</code> script. There&rsquo;s nothing terribly exciting here, just build the site and run <code>html-proofer</code> on it.</p>

<pre><code class="language-bash">bundle exec jekyll build
bundle exec htmlproof ./_site
</code></pre>

<p>The real magic happens in the <code>deploy</code> script.</p>

<pre><code class="language-bash">sudo apt-get install -qq ncftp

ncftp -u &quot;$USERNAME&quot; -p &quot;$PASSWORD&quot; $HOST&lt;&lt;EOF
rm -rf site/wwwroot
mkdir site/wwwroot
quit
EOF

cd _site
ncftpput -R -v -u &quot;$USERNAME&quot; -p &quot;$PASSWORD&quot; $HOST /site/wwwroot .
</code></pre>

<p>I&rsquo;m making use of a handy program called <code>ncftp</code> in order to deploy my site. Firstly Travis deletes the currently deployed site, then puts the generated Jekyll site on the FTP server.</p>

<h2 id="travis">Travis</h2>

<p>To put it all together you need to configure Travis builds for your GitHub repository, and set the environment variables to allow Travis to deploy to Azure:</p>

<ul>
<li>Go your your <a href="https://travis-ci.org/profile">Travis profile</a></li>
<li>Click the slider next to your Jekyll repository</li>
<li>Go to your <a href="https://travis-ci.org/repositories">repositories</a> and click on your Jekyll repository</li>
<li>Click Settings &gt; Environment variables</li>
<li>Set environment variables for your Azure Web App where

<ul>
<li><code>USERNAME</code> is <code>azure-web-app-name\\azure-deployment-username</code></li>
<li><code>PASSWORD</code> is <code>azure-deployment-password</code></li>
<li><code>HOST</code> is <code>ftp-server-name.ftp.azurewebsites.windows.net</code></li>
</ul></li>
</ul>

<p><img src="/img/travis-environment-variables.png" alt="Travis environment variables&quot;" /></p>

<p>Remember that <code>USERNAME</code> requires a double backslash to escape the character in the terminal.</p>

<h2 id="putting-it-all-together">Putting it all together</h2>

<p>Now that everything is all configured all you need to do is push a commit to GitHub and wait. If everything is good you should see your Jekyll site deployed automatically to your Azure Web App - though if you&rsquo;re anything like me <code>html-proofer</code> will have picked up some broken links on your site!</p>


    </div>



<div class="pagination">

  <a class="pagination-item" href="/">Newer</a>


  <span class="pagination-item">Older</span>

</div>



  </div>
</div>


<script type="text/javascript">
var disqus_shortname = "jamiemagee";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>

<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="/js/cms.js"></script>
</body>
</html>
