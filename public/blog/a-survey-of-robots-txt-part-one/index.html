<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">


  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>A survey of robots.txt - part one &middot; Jamie Magee</title>


  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/hyde.css">
  <link rel="stylesheet" href="/css/poole-overrides.css">
  <link rel="stylesheet" href="/css/hyde-overrides.css">
  <link rel="stylesheet" href="/css/hyde-x.css">
  <link rel="stylesheet" href="/css/highlight/github.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/jamie.css">


  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
  <link href="/favicon.ico" rel="icon">






  <meta name="description" content="">
  <meta name="keywords" content="">


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-701081-9', 'auto');

	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body class="theme-base-0c">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <div class="sidebar-head">

        <img src="https://www.gravatar.com/avatar/5a37e2531db08529192d7d323e8cecd8?s=200"
             alt="gravatar" title="Jamie Magee">

      <h1><a href="/">Jamie Magee</a></h1>
      </div>
      <p class="lead">Programmer, Engineer, Problem Solver</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="/">Home</a></li>

      <li class="sidebar-nav-item "><a href="/about">About</a></li>

      <li class="sidebar-nav-item "><a href="/blog">Archive</a></li>

    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/JamieMagee"><i class="fa fa-github-square fa-3x"></i></a>


      <a href="https://www.linkedin.com/in/jamiemagee1/"><i class="fa fa-linkedin-square fa-3x"></i></a>


      <a href="http://twitter.com/Jamie_Magee"><i class="fa fa-twitter-square fa-3x"></i></a>


      </li>
    </ul>



    <p>
  &copy; 2019. <a href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a>
</p>

  </div>
</div>


<div class="content container">
  <div class="post">
    <h1 class="post-title">A survey of robots.txt - part one</h1>
    <span class="post-date">Sep 19, 2017 &middot; 3 minute read &middot; <a href="/blog/a-survey-of-robots-txt-part-one/#disqus_thread">Comments</a>
    </span>


<p>After reading <a href="https://www.kaggle.com/colinmorris/unusual-favicons-a-brief-survey">CollinMorris&rsquo;s analysis of favicons</a> of the top 1 million sites on the web, I thought it would be interesting to do the same for other common parts of websites that often get overlooked.</p>

<p>The <code>robots.txt</code> file is a plain text file found at on most websites which communicates information to web crawlers and spiders about how to scan a website.. For example, here&rsquo;s an excerpt from <code>robots.txt</code> for <code>google.com</code></p>

<pre><code class="language-txt">User-agent: *
Disallow: /search
Allow: /search/about
Allow: /search/howsearchworks
...
</code></pre>

<p>The above excerpt tells all web crawlers not to scan the <code>/search</code> path, but allows them to scan <code>/search/about</code> and <code>/search/howsearchworks</code> paths. There are a few more supported keywords, but these are the most common. Following these instructions is not required, but it is considered good internet etiquette. If you want to read more about the standard, Wikipedia has a great page <a href="https://en.wikipedia.org/wiki/Robots_exclusion_standard">here</a>.</p>

<p>In order to do an analysis of <code>robots.txt</code>, first I need to crawl the web for them â€“ ironic, I know.</p>

<h2 id="scraping">Scraping</h2>

<p>I wrote a scraper using <a href="https://scrapy.org/">scrapy</a> to make a request for <code>robots.txt</code> for each of the domains in Alexa&rsquo;s top 1 million websites. If the response code was 200, the <code>Content-Type</code> header contained <code>text/plain</code>, and the response body was not empty, I stored the response body in a file, with the same name as the domain name.</p>

<p>One complication I encountered was that not all domains respond on the same protocol or subdomain. For example, some websites respond on <code>http://{domain_name}</code> while others require <code>http://www.{domain_name}</code>. If a website doesn&rsquo;t automatically redirect you to the correct protocol or subdomain, the only way to find the correct one, is to try them all! So I wrote a small class, extending scrapy&rsquo;s <code>RetryMiddleware</code>, to do this:</p>

<pre><code class="language-python">COMMON_PREFIXES = {'http://', 'https://', 'http://www.', 'https://www.'}

class PrefixRetryMiddleware(RetryMiddleware):

    def process_exception(self, request, exception, spider):
            prefixes_tried = request.meta['prefixes']
            if COMMON_PREFIXES == prefixes_tried:
                return exception

            new_prefix = choice(tuple(COMMON_PREFIXES - prefixes_tried))
            request = self.update_request(request, new_prefix)

            return self._retry(request, exception, spider)
</code></pre>

<p>The rest of the scraper itself is quite simple, but you can read the full code <a href="https://github.com/JamieMagee/robots-txt">on GitHub</a>.</p>

<h2 id="results">Results</h2>

<p>Scraping the full Alexa top 1 million websites list took around 24 hours. Once it was finished, I had just under 700k robots.txt files</p>

<pre><code class="language-bash">$ find -type f | wc -l
677686
</code></pre>

<p>totalling 493MB</p>

<pre><code class="language-bash">$ du -sh
493M    .
</code></pre>

<p>The smallest <code>robots.txt</code> was 1 byte<sup class="footnote-ref" id="fnref:1"><a href="#fn:1">1</a></sup>, but the largest was over 5MB.</p>

<pre><code class="language-bash">$ find -type f -exec du -Sh {} + | sort -rh | head -n 1
5.6M    ./haberborsa.com.tr

$ find -not -empty -type f -exec du -b {} + | sort -h | head -n 1
1    ./0434.cc
</code></pre>

<p>The full data set is released under the <a href="https://opendatacommons.org/licenses/odbl/1.0/">Open Database License (ODbL) v1.0</a> and can be found <a href="https://github.com/JamieMagee/robots-txt">on GitHub</a></p>

<h2 id="what-s-next">What&rsquo;s next?</h2>

<p>In the next part of this blog series I&rsquo;m going to analyse all the <code>robots.txt</code> to see if I can find anything interesting. In particular I&rsquo;d like to know why exactly someone needs a <code>robots.txt</code> file over 5MB in size, what is the most common web crawler listed (either allowed or disallowed), and are there any sites practising security by obscurity by trying to keep links out of search engines!</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1">I needed to include <code>-not -empty</code> when looking for the smallest file, as there were errors when decoding the response body for some domains. I&rsquo;ve included the empty files in the dataset for posterity, but I will exclude them from further analysis.
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
</ol>
</div>

  </div>
  <div id="disqus_thread"></div>
</div>


<script type="text/javascript">
var disqus_shortname = "jamiemagee";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



<script type="text/javascript">
    var disqus_shortname = "jamiemagee";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="/js/cms.js"></script>
</body>
</html>
