---
title: 'Netlify billing Denial-of-Service'
date: '2021-04-11'
comments: true
---

At its heart, [Netlify](https://www.netlify.com/) is a platform for hosting static websites. I initially started using it as an alternative to [GitHub Pages](https://pages.github.com/), and features like [Netlify CMS](https://www.netlifycms.org/) and [preview deploys](https://www.netlify.com/blog/2016/07/20/introducing-deploy-previews-in-netlify/) really won me over. However, I recently got bit by preview deploys and the build minutes pricing.

I had a few GitHub repos set up to automatically deploy to Netlify previews from pull requests. I had also configured [Renovate](https://renovate.whitesourcesoftware.com/) to automatically open pull requests for my dependencies. Javascript projects have a lot of dependencies, so there were more than a few pull requests!

Originally Netlify didn't charge for build minutes, but in October 2019 they introduced a cap of 300 minutes per month on the start plan, with the option to buy packs of 500 build minutes for $7. I'm not criticising them for this change. I understand that they need to make money, and I think $7 for 500 minutes is a reasonable price. However, I don't think Netlify has put the necessary protections in place for their customers.

![](/img/netlify-1.png)

## SaaS cost attack

A quick Google search for "huge bill" for AWS, Azure, or GCP returns thousands of results. Stories of people who, at best, misconfigured their infrastructure or, at worst, were the target of a DDoS attack. Whatever the cause, the outcome is the same: a massive bill for thousands of dollars.

The big three cloud providers, and most other SaaS companies, offer some sort of protections or hard limits to prevent these sorts of surprises: Azure has [Azure Cost Management + Billing](https://azure.microsoft.com/en-us/services/cost-management/), AWS has [AWS Budget](https://aws.amazon.com/aws-cost-management/aws-budgets/), and GCP has [Cloud Billing budgets](https://cloud.google.com/billing/docs/how-to/budgets). Netlify has no such protections.

![](/img/netlify-2.png)

To me, this seems like a massive oversight and is a core feature that most users, and all business, would expect to have. Obviously the intention here is for Netlify to be able to charge customers when they exceed their build minutes. This also leaves open a massive opportunity for malicious actors to incur huge costs for Netlify customers with very little effort.

## Proof-of-concept

Netlify allows you to configure your site's build using a `netlify.toml` stored in the root of your repository. Here's an excerpt taken from [their documentation](https://docs.netlify.com/configure-builds/file-based-configuration/#sample-file):

```yaml
# Settings in the [build] context are global and are applied to all contexts
# unless otherwise overridden by more specific contexts.
[build]
  # Directory to change to before starting a build.
  # This is where we will look for package.json/.nvmrc/etc.
  base = "project/"

  # Directory that contains the deploy-ready HTML files and assets generated by
  # the build. This is relative to the base directory if one has been set, or the
  # root directory if a base has not been set. This sample publishes the
  # directory located at the absolute path "root/project/build-output"
  publish = "build-output/"

  # Default build command.
  command = "echo 'default context'"
```

If I were to replace `command` with something like `sleep 120` and open a pull request that uses Netlify and has not explicitly disabled deploy previews, the Netlify build will happily build my pull request and sleep for two minutes.

![](/img/netlify-3.png)

A quick [search on GitHub](https://github.com/search?q=filename%3Anetlify.toml) for `filename:netlify.toml` shows there are approximately forty thousand repositories that are potentially vulnerable to this style of attack.

One small mercy is the fact that Netlify limits builds to 15 minutes by default. So, to cost anyone any money, someone would have to open 20 pull requests with `command = "sleep 900"`. At that point, I hope either the repository owner would notice, GitHub would rate-limit you, or it would catch the attention of Netlify.

## What next?

I was recently bitten by unexpected charges for build minutes. After contacting Netlify they, very kindly, forgave the charges. However, when I asked about billing protection for customers they replied:

> Our policy is to keep your website and builds running as you expect, rather than leaving things in an inconsistent state. I understand it is not what you prefer, but it is what our business prioritizes - expected behavior and continuous uptime for your website and build processes. I have however recorded your feedback for our billing team.

Personally, I have disabled preview deploys on all my sites on Netlify and moved the builds to GitHub Actions. I still use Netlify for NetlifyCMS, but I might look into [using NetlifyCMS with a custom OAuth provider](https://tylergaw.com/articles/netlify-cms-custom-oath-provider/) in the future.