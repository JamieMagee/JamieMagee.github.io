<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><link href=http://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Continuously deploy Jekyll to Azure Web Apps &#183; Jamie Magee</title><link rel=preload href=/css/poole.css as=style><link rel=preload href=/css/hyde.css as=style><link rel=preload href=/css/poole-overrides.css as=style><link rel=preload href=/css/hyde-overrides.css as=style><link rel=preload href=/css/hyde-x.css as=style><link rel=preload href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface" as=font><link rel=preload href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css as=style><link rel=stylesheet href=/css/poole.css><link rel=stylesheet href=/css/hyde.css><link rel=stylesheet href=/css/poole-overrides.css><link rel=stylesheet href=/css/hyde-overrides.css><link rel=stylesheet href=/css/hyde-x.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css><style>@font-face{font-family:berkeley mono;src:url(/fonts/BerkeleyMono-Regular.woff2)format('woff2')}</style><link rel=stylesheet href=/css/jamie.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link href=/favicon.ico rel=icon><meta name=description content><meta name=keywords content><meta property="og:title" content="Continuously deploy Jekyll to Azure Web Apps"><meta property="og:description" content="I&rsquo;ve been thinking about writing a blog for a while now, but there are just so many blogging platforms out there to choose from. I finally settled on Jekyll as it&rsquo;s really lightweight (compared to platforms like Wordpress), it has an active development community, and you can write all your articles in Markdown.
Many Jekyll users host their Jekyll sites through GitHub Pages, and there are a lot of advantages to this:"><meta property="og:type" content="article"><meta property="og:url" content="/blog/continuous-deployment-jekyll-to-azure/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2015-03-31T00:00:00+00:00"><meta property="article:modified_time" content="2015-03-31T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Continuously deploy Jekyll to Azure Web Apps"><meta name=twitter:description content="I&rsquo;ve been thinking about writing a blog for a while now, but there are just so many blogging platforms out there to choose from. I finally settled on Jekyll as it&rsquo;s really lightweight (compared to platforms like Wordpress), it has an active development community, and you can write all your articles in Markdown.
Many Jekyll users host their Jekyll sites through GitHub Pages, and there are a lot of advantages to this:"></head><body class=theme-base-0c><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><div class=sidebar-head><h1><a href=/>Jamie Magee</a></h1></div><p class=lead>Programmer, Engineer, Problem Solver</p></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>Home</a></li><li class=sidebar-nav-item><a href=/about>About</a></li><li class=sidebar-nav-item><a href=/blog>Archive</a></li></ul><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://github.com/JamieMagee><i class="fa fa-github-square fa-3x"></i></a>
<a href=https://www.linkedin.com/in/jamiemagee1/><i class="fa fa-linkedin-square fa-3x"></i></a>
<a href=http://twitter.com/Jamie_Magee><i class="fa fa-twitter-square fa-3x"></i></a></li></ul><p>&copy; 2023. <a href=https://creativecommons.org/licenses/by-nc/4.0/>CC BY-NC 4.0</a></p></div></div><div class="content container"><div class=post><h1 class=post-title>Continuously deploy Jekyll to Azure Web Apps</h1><span class=post-date>Mar 31, 2015 &#183; 4 minute read &#183; <a href=/blog/continuous-deployment-jekyll-to-azure/#disqus_thread>Comments</a></span><p>I&rsquo;ve been thinking about writing a blog for a while now, but there are just so many blogging platforms out there to choose from. I finally settled on Jekyll as it&rsquo;s really lightweight (compared to platforms like Wordpress), it has an active development community, and you can write all your articles in Markdown.</p><p>Many Jekyll users host their Jekyll sites through GitHub Pages, and there are a lot of advantages to this:</p><ul><li>Free web hosting</li><li>Built in version control</li><li>Continuous deployment</li></ul><p>However, the main disadvantage is that GitHub Pages runs Jekyll in safe mode. This means that it&rsquo;s not possible to extend Jekyll with plugins. There are some ways to avoid this restriction, but they&rsquo;re all awkward workarounds.</p><h2 id=a-solution>A solution</h2><p>I still wanted all the advantages GitHub Pages has, but with Jekyll plugins too. The solution was to use <a href=https://travis-ci.org>Travis</a> to build the Jekyll site and host it on <a href=https://azure.microsoft.com/en-us/services/app-service/web/>Azure Web Apps</a>. Travis is a continuous integration service that&rsquo;s free for open source projects to use, and I&rsquo;m going to use it to build my Jekyll site. Azure provides cheap, or even free, web hosting for websites and it&rsquo;s what I&rsquo;m familiar with.</p><h2 id=azure>Azure</h2><p>First of all you need to create an Azure Web App.</p><ul><li>Go to the <a href=https://portal.azure.com>Azure Portal</a></li><li>Click New > Compute > Web App > Quick Create</li><li>Enter the URL you want and select an app service plan</li></ul><p><img src=/img/azure-new-web-app.png alt="Azure new web app"></p><p>On the dashboard for your new web app, make a note of the FTP host name and your deployment credentials. If you&rsquo;ve forgotten your deployment credentials you can reset them from here as well.</p><h2 id=github>GitHub</h2><p>I know I said earlier that I didn&rsquo;t want to use GitHub, but I&rsquo;m not actually using GitHub Pages. Travis depends on <a href=https://developer.github.com/v3/repos/hooks/>GitHub Webhooks</a> in order to figure out when you push an update to your site and kick off a build. In addition to the standard Jekyll files you&rsquo;ll need to add a <code>.travis.yml</code> configuration file as well as a build and deploy script. My Travis configuration looks like this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:navy>language</span>:<span style=color:#bbb> </span>ruby<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#bbb></span><span style=color:navy>rvm</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#bbb>  </span>- <span style=color:#099>2.2</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#bbb></span><span style=color:navy>script</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#bbb>  </span>- chmod +x script/build<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#bbb>  </span>- ./script/build<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#bbb></span><span style=color:navy>after_success</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#bbb>  </span>- chmod +x script/deploy<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#bbb>  </span>- ./script/deploy<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#bbb></span><span style=color:navy>env</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#bbb>  </span><span style=color:navy>global</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#bbb>    </span>- NOKOGIRI_USE_SYSTEM_LIBRARIES=true<span style=color:#bbb>
</span></span></span></code></pre></div><p>Taking it section by section</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:navy>language</span>:<span style=color:#bbb> </span>ruby<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#bbb></span><span style=color:navy>rvm</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#bbb>  </span>- <span style=color:#099>2.2</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>This tells Travis that the project is Ruby based, and what version of Ruby to use - in this case Ruby 2.2.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:navy>script</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#bbb>  </span>- chmod +x script/build<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#bbb>  </span>- ./script/build<span style=color:#bbb>
</span></span></span></code></pre></div><p>My build script in the <code>scripts</code> directory. This sets the execute flag, then executes it.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:navy>after_success</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#bbb>  </span>- chmod +x script/deploy<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#bbb>  </span>- ./script/deploy<span style=color:#bbb>
</span></span></span></code></pre></div><p>If the build is successful, Travis will set the execute flag on the <code>deploy</code> script, then execute it.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:navy>env</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#bbb>  </span><span style=color:navy>global</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#bbb>    </span>- NOKOGIRI_USE_SYSTEM_LIBRARIES=true<span style=color:#bbb>
</span></span></span></code></pre></div><p>I&rsquo;m using <code>html-proofer</code> to check all the links and images on my site, and this allows me to speed up the build time by using pre-installed libraries.</p><p>Now onto the <code>build</code> script. There&rsquo;s nothing terribly exciting here, just build the site and run <code>html-proofer</code> on it.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>bundle <span style=color:#0086b3>exec</span> jekyll build
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>bundle <span style=color:#0086b3>exec</span> htmlproof ./_site
</span></span></code></pre></div><p>The real magic happens in the <code>deploy</code> script.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>sudo apt-get install -qq ncftp
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>ncftp -u <span style=color:#d14>&#34;</span><span style=color:teal>$USERNAME</span><span style=color:#d14>&#34;</span> -p <span style=color:#d14>&#34;</span><span style=color:teal>$PASSWORD</span><span style=color:#d14>&#34;</span> <span style=color:teal>$HOST</span><span style=color:#d14>&lt;&lt;EOF
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#d14>rm -rf site/wwwroot
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#d14>mkdir site/wwwroot
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#d14>quit
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#d14>EOF</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#0086b3>cd</span> _site
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>ncftpput -R -v -u <span style=color:#d14>&#34;</span><span style=color:teal>$USERNAME</span><span style=color:#d14>&#34;</span> -p <span style=color:#d14>&#34;</span><span style=color:teal>$PASSWORD</span><span style=color:#d14>&#34;</span> <span style=color:teal>$HOST</span> /site/wwwroot .
</span></span></code></pre></div><p>I&rsquo;m making use of a handy program called <code>ncftp</code> in order to deploy my site. Firstly Travis deletes the currently deployed site, then puts the generated Jekyll site on the FTP server.</p><h2 id=travis>Travis</h2><p>To put it all together you need to configure Travis builds for your GitHub repository, and set the environment variables to allow Travis to deploy to Azure:</p><ul><li>Go your your <a href=https://travis-ci.org/profile>Travis profile</a></li><li>Click the slider next to your Jekyll repository</li><li>Go to your <a href=https://travis-ci.org/repositories>repositories</a> and click on your Jekyll repository</li><li>Click Settings > Environment variables</li><li>Set environment variables for your Azure Web App where<ul><li><code>USERNAME</code> is <code>azure-web-app-name\\azure-deployment-username</code></li><li><code>PASSWORD</code> is <code>azure-deployment-password</code></li><li><code>HOST</code> is <code>ftp-server-name.ftp.azurewebsites.windows.net</code></li></ul></li></ul><p><img src=/img/travis-environment-variables.png alt='Travis environment variables"'></p><p>Remember that <code>USERNAME</code> requires a double backslash to escape the character in the terminal.</p><h2 id=putting-it-all-together>Putting it all together</h2><p>Now that everything is all configured all you need to do is push a commit to GitHub and wait. If everything is good you should see your Jekyll site deployed automatically to your Azure Web App - though if you&rsquo;re anything like me <code>html-proofer</code> will have picked up some broken links on your site!</p></div><div id=disqus_thread></div></div><script type=text/javascript>var disqus_shortname="jamiemagee";(function(){var e=document.createElement("script");e.async=!0,e.type="text/javascript",e.src="//"+disqus_shortname+".disqus.com/count.js",(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(e)})()</script><script type=text/javascript>var disqus_shortname="jamiemagee";(function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=http://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></body></html>